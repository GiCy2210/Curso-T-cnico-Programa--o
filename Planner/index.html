<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kuromi Planner - Organização Pessoal</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --roxo-escuro: #4A2C7E;
      --roxo-medio: #7B5AB5;
      --lilás: #b89cd9;
      --lilás-claro: #f4e6fa;
      --rosa: #FF9EC8;
      --preto: #1A1A1A;
      --branco: #e1adff;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Nunito', sans-serif;
    }
    
    body {
      background-color: var(--lilás-claro);
      color: var(--preto);
      background-image: 
      radial-gradient(circle at 20% 30%, rgba(192, 158, 219, 0.3) 0%, transparent 30%),
      radial-gradient(circle at 80% 70%, rgba(248, 187, 213, 0.685) 0%, transparent 30%),
      radial-gradient(circle at 40% 80%, rgba(121, 90, 181, 0.2) 0%, transparent 30%);
      background-attachment: fixed;
      min-height: 100vh;
      padding-bottom: 50px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    header {
      background-color: var(--roxo-escuro);
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 30px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      position: relative;
      overflow: hidden;
      color: var(--branco);
    }
    
    header::before {
      content: "";
      position: absolute;
      top: -30px;
      right: -30px;
      width: 150px;
      height: 150px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath d='M50,20 A30,30 0 1,1 50,80 A30,30 0 1,1 50,20 Z' fill='none' stroke='%237B5AB5' stroke-width='2'/%3E%3Cpath d='M35,50 L65,50 M50,35 L50,65' fill='none' stroke='%237B5AB5' stroke-width='2'/%3E%3C/svg%3E");
      opacity: 0.3;
    }
    
    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    h1 i {
      color: var(--rosa);
    }
    
    .subtitle {
      font-size: 1.2rem;
      margin-bottom: 20px;
    }
    
    .nav-tabs {
      display: flex;
      list-style: none;
      background-color: var(--roxo-medio);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 0;
    }
    
    .nav-tabs li {
      flex: 1;
    }
    
    .nav-tabs a {
      display: block;
      padding: 15px;
      text-align: center;
      color: var(--branco);
      text-decoration: none;
      transition: background-color 0.3s;
    }
    
    .nav-tabs a:hover, .nav-tabs a.active {
      background-color: var(--lilás);
      color: var(--roxo-escuro);
    }
    
    .main-content {
      display: grid;
      grid-template-columns: 1fr 2fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .widget {
      background-color: var(--branco);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    .widget h2 {
      color: var(--roxo-escuro);
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--lilás);
      position: relative;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .widget h2::after {
      content: "";
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 30px;
      height: 10px;
      background-color: var(--rosa);
      border-radius: 5px;
    }
    
    .calendar {
      grid-column: 2;
    }
    
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .calendar-nav {
      display: flex;
      gap: 10px;
    }
    
    .calendar-nav button {
      background-color: var(--roxo-medio);
      color: white;
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
    }
    
    .calendar-weekdays {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      text-align: center;
      font-weight: bold;
      margin-bottom: 10px;
      color: var(--roxo-medio);
    }
    
    .calendar-cell {
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      border-radius: 10px;
      cursor: pointer;
      transition: background-color 0.3s;
      position: relative;
      padding: 5px;
      overflow: hidden;
    }
    
    .calendar-cell:hover {
      background-color: var(--lilás-claro);
    }
    
    .calendar-cell.current {
      background-color: var(--roxo-medio);
      color: var(--branco);
    }
    
    .calendar-cell.has-events::after {
      content: "";
      position: absolute;
      bottom: 5px;
      width: 6px;
      height: 6px;
      background-color: var(--rosa);
      border-radius: 50%;
    }
    
    .event-dot {
      width: 6px;
      height: 6px;
      background-color: var(--rosa);
      border-radius: 50%;
      margin-top: 2px;
    }
    
    .event-title {
      font-size: 0.6rem;
      text-align: center;
      margin-top: 3px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      width: 100%;
      color: var(--roxo-escuro);
      font-weight: bold;
    }
    
    .todo-list ul {
      list-style: none;
    }
    
    .todo-list li {
      padding: 10px;
      border-bottom: 1px solid var(--lilás-claro);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .todo-list li:last-child {
      border-bottom: none;
    }
    
    .todo-list input[type='checkbox'] {
      margin-right: 5px;
      accent-color: var(--roxo-medio);
    }
    
    .todo-list .completed {
      text-decoration: line-through;
      color: var(--lilás);
    }
    
    .todo-list .delete-btn {
      margin-left: auto;
      color: var(--roxo-medio);
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.3s;
    }
    
    .todo-list .delete-btn:hover {
      opacity: 1;
      color: #ff5252;
    }
    
    .add-task-form {
      display: flex;
      margin-top: 15px;
      gap: 10px;
    }
    
    .add-task-form input {
      flex: 1;
      padding: 10px;
      border: 1px solid var(--lilás);
      border-radius: 5px;
      outline: none;
    }
    
    .add-task-form button {
      background-color: var(--roxo-medio);
      color: var(--branco);
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .motivation {
      text-align: center;
      font-style: italic;
      color: var(--roxo-medio);
      margin: 20px 0;
      padding: 15px;
      background-color: rgba(255, 255, 255, 0.5);
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .motivation-btn {
      background-color: var(--roxo-medio);
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 20px;
      cursor: pointer;
      margin: 0 auto;
      width: fit-content;
    }
    
    footer {
      text-align: center;
      padding: 20px;
      color: var(--roxo-medio);
      font-size: 0.9rem;
    }
    
    .kuromi-decoration {
      position: fixed;
      bottom: 20px;
      right: 60px;
      width: 300px;
      height: 200px;
      background-image: url("https://github.com/GiCy2210/Portif-lio/blob/main/kuromi_mymelody_sticker_small.png?raw=true");
      background-repeat: no-repeat;
      opacity: 0.7;
      z-index: -1;
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 100;
      align-items: center;
      justify-content: center;
    }
    
    .modal-content {
      background-color: var(--branco);
      padding: 20px;
      border-radius: 15px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--lilás);
    }
    
    .close-modal {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--roxo-medio);
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      color: var(--roxo-escuro);
    }
    
    .form-group input, .form-group textarea, .form-group select {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--lilás);
      border-radius: 5px;
    }
    
    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 600;
    }
    
    .btn-primary {
      background-color: var(--roxo-medio);
      color: white;
    }
    
    .btn-secondary {
      background-color: var(--lilás-claro);
      color: var(--roxo-escuro);
    }
    
    .btn-danger {
      background-color: #e74c3c;
      color: white;
    }
    
    .empty-state {
      text-align: center;
      padding: 20px;
      color: var(--lilás);
    }
    
    @media (max-width: 768px) {
      .main-content {
        grid-template-columns: 1fr;
      }
      
      .calendar {
        grid-column: 1;
      }
      
      .nav-tabs {
        flex-direction: column;
      }
      
      h1 {
        font-size: 2rem;
      }
      
      .event-title {
        font-size: 0.5rem;
      }
    }
  </style>
</head>
<body>
  <div class="kuromi-decoration"></div>
  
  <div class="container">
    <header>
      <h1><i class="fas fa-heart"></i>Seu Planner</h1>
      <p class="subtitle">Espero que te ajude a se organizar!</p>
      
      <ul class="nav-tabs">
        <li><a href="#" class="active"><i class="fas fa-home"></i> Início</a></li>
        <li><a href="#"><i class="far fa-calendar"></i> Calendário</a></li>
        <li><a href="#"><i class="fas fa-tasks"></i> Tarefas</a></li>
        <li><a href="#"><i class="fas fa-bullseye"></i> Metas</a></li>
      </ul>
    </header>
    
    <div class="main-content">
      <div class="widget">
        <h2><i class="fas fa-bullseye"></i> Minhas Metas</h2>
        <div id="goals-list">
          <div class="empty-state">
            <i class="fas fa-plus-circle" style="font-size: 2rem; margin-bottom: 10px;"></i>
            <p>Você ainda não tem metas</p>
            <button class="motivation-btn" onclick="openAddGoalModal()">Adicionar Meta</button>
          </div>
        </div>
      </div>
      
      <div class="widget calendar">
        <div class="calendar-header">
          <h2><i class="far fa-calendar"></i> <span id="current-month">Setembro 2023</span></h2>
          <div class="calendar-nav">
            <button id="prev-month"><i class="fas fa-chevron-left"></i></button>
            <button id="today-btn">Hoje</button>
            <button id="next-month"><i class="fas fa-chevron-right"></i></button>
          </div>
        </div>
        <div class="calendar-weekdays">
          <div>Dom</div>
          <div>Seg</div>
          <div>Ter</div>
          <div>Qua</div>
          <div>Qui</div>
          <div>Sex</div>
          <div>Sáb</div>
        </div>
        <div class="calendar-grid" id="calendar-days">
          <!-- Dias do calendário serão gerados via JavaScript -->
        </div>
      </div>
      
      <div class="widget">
        <h2><i class="far fa-bell"></i> Lembretes</h2>
        <div id="reminders-list">
          <div class="empty-state">
            <i class="far fa-bell" style="font-size: 2rem; margin-bottom: 10px;"></i>
            <p>Nenhum lembrete adicionado</p>
            <button class="motivation-btn" onclick="openAddReminderModal()">Adicionar Lembrete</button>
          </div>
        </div>
      </div>
    </div>
    
    <div class="widget todo-list">
      <h2><i class="fas fa-tasks"></i> Lista de Tarefas</h2>
      <ul id="task-list">
        <!-- Tarefas serão adicionadas dinamicamente -->
      </ul>
      <div class="add-task-form">
        <input type="text" id="new-task-input" placeholder="Nova tarefa...">
        <button id="add-task-btn"><i class="fas fa-plus"></i> Adicionar</button>
      </div>
    </div>
    
    <div class="motivation">
      <p id="motivation-text">"A organização é a chave para libertar tempo para o que realmente importa."</p>
      <button class="motivation-btn" id="new-motivation"><i class="fas fa-sync"></i> Nova Motivação</button>
    </div>
  </div>
  
  <!-- Modal para adicionar eventos -->
  <div class="modal" id="event-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Adicionar Evento</h3>
        <button class="close-modal" onclick="closeModal('event-modal')">&times;</button>
      </div>
      <div class="form-group">
        <label for="event-title">Título do Evento</label>
        <input type="text" id="event-title" placeholder="Nome do evento">
      </div>
      <div class="form-group">
        <label for="event-date">Data</label>
        <input type="date" id="event-date">
      </div>
      <div class="form-group">
        <label for="event-description">Descrição (opcional)</label>
        <textarea id="event-description" rows="3"></textarea>
      </div>
      <div class="form-actions">
        <button class="btn btn-secondary" onclick="closeModal('event-modal')">Cancelar</button>
        <button class="btn btn-primary" onclick="addEvent()">Salvar</button>
      </div>
    </div>
  </div>
  
  <!-- Modal para visualizar eventos -->  
  <div class="modal" id="view-event-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Detalhes do Evento</h3>
        <button class="close-modal" onclick="closeModal('view-event-modal')">&times;</button>
      </div>
      <div id="event-details">
        <!-- Conteúdo preenchido dinamicamente -->
      </div>
      <div class="form-actions">
        <button class="btn btn-secondary" onclick="closeModal('view-event-modal')">Fechar</button>
        <button class="btn btn-danger" id="delete-event-btn">Excluir Evento</button>
      </div>
    </div>
  </div>
  
  <!-- Modal para adicionar metas -->
  <div class="modal" id="goal-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Adicionar Meta</h3>
        <button class="close-modal" onclick="closeModal('goal-modal')">&times;</button>
      </div>
      <div class="form-group">
        <label for="goal-title">Título da Meta</label>
        <input type="text" id="goal-title" placeholder="Ex: Ler 20 livros este ano">
      </div>
      <div class="form-group">
        <label for="goal-deadline">Prazo (opcional)</label>
        <input type="date" id="goal-deadline">
      </div>
      <div class="form-actions">
        <button class="btn btn-secondary" onclick="closeModal('goal-modal')">Cancelar</button>
        <button class="btn btn-primary" onclick="addGoal()">Salvar</button>
      </div>
    </div>
  </div>
  
  <!-- Modal para adicionar lembretes -->
  <div class="modal" id="reminder-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Adicionar Lembrete</h3>
        <button class="close-modal" onclick="closeModal('reminder-modal')">&times;</button>
      </div>
      <div class="form-group">
        <label for="reminder-title">Lembrete</label>
        <input type="text" id="reminder-title" placeholder="Ex: Pagar conta de luz">
      </div>
      <div class="form-group">
        <label for="reminder-date">Data (opcional)</label>
        <input type="date" id="reminder-date">
      </div>
      <div class="form-actions">
        <button class="btn btn-secondary" onclick="closeModal('reminder-modal')">Cancelar</button>
        <button class="btn btn-primary" onclick="addReminder()">Salvar</button>
      </div>
    </div>
  </div>
  
  <footer>
    <p>Camilly Planner © 2025</p>
  </footer>
  <script>
    // Dados da aplicação
    let tasks = [];
    let events = [];
    let goals = [];
    let reminders = [];
    let currentDate = new Date();
    let currentViewDate = new Date();
    let selectedEventId = null;
    
    // Frases motivacionais
    const motivations = [
    "A organização é a chave para libertar tempo para o que realmente importa.",
    "Seu futuro é criado pelo que você faz hoje, não amanhã.",
    "Comece onde você está, use o que você tem, faça o que você pode.",
    "Não é sobre ter tempo, é sobre fazer tempo.",
    "Pequenos progressos diários levam a resultados impressionantes.",
    "A disciplina é a ponte entre metas e realizações.",
    "Você não precisa ser grande para começar, mais precisa começar para ser grande."
    ];
    
    // Inicialização
    document.addEventListener('DOMContentLoaded', function() {
      loadFromLocalStorage();
      renderCalendar();
      renderTasks();
      renderGoals();
      renderReminders();
      setupEventListeners();
      setupNavigation();
      newMotivation();
    });
    
    // Configurar listeners de eventos
    function setupEventListeners() {
      // Navegação do calendário
      document.getElementById('prev-month').addEventListener('click', () => {
        currentViewDate.setMonth(currentViewDate.getMonth() - 1);
        renderCalendar();
      });
      
      document.getElementById('next-month').addEventListener('click', () => {
        currentViewDate.setMonth(currentViewDate.getMonth() + 1);
        renderCalendar();
      });
      
      document.getElementById('today-btn').addEventListener('click', () => {
        currentViewDate = new Date();
        renderCalendar();
      });
      
      // Adicionar tarefa
      document.getElementById('add-task-btn').addEventListener('click', addTaskFromInput);
      document.getElementById('new-task-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') addTaskFromInput();
      });
      
      // Nova motivação
      document.getElementById('new-motivation').addEventListener('click', newMotivation);
      
      // Excluir evento
      document.getElementById('delete-event-btn').addEventListener('click', deleteEvent);
    }
    
    // Gerar calendário
    function renderCalendar() {
      const calendarDays = document.getElementById('calendar-days');
      const monthYearElement = document.getElementById('current-month');
      
      // Limpar calendário
      calendarDays.innerHTML = '';
      
      // Atualizar título do mês/ano
      const monthNames = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho",
      "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
      monthYearElement.textContent = `${monthNames[currentViewDate.getMonth()]} ${currentViewDate.getFullYear()}`;
      
      // Obter primeiro dia do mês e último dia do mês
      const firstDay = new Date(currentViewDate.getFullYear(), currentViewDate.getMonth(), 1);
      const lastDay = new Date(currentViewDate.getFullYear(), currentViewDate.getMonth() + 1, 0);
      
      // Dias da semana (0 = Domingo, 1 = Segunda, etc.)
      const startDayOfWeek = firstDay.getDay();
      const daysInMonth = lastDay.getDate();
      
      // Dias do mês anterior (para preencher o início)
      const prevMonthLastDay = new Date(currentViewDate.getFullYear(), currentViewDate.getMonth(), 0).getDate();
      
      // Adicionar dias do mês anterior
      for (let i = startDayOfWeek - 1; i >= 0; i--) {
        const dayCell = document.createElement('div');
        dayCell.classList.add('calendar-cell');
        dayCell.textContent = prevMonthLastDay - i;
        dayCell.style.opacity = '0.4';
        calendarDays.appendChild(dayCell);
      }
      
      // Adicionar dias do mês atual
      const today = new Date();
      for (let i = 1; i <= daysInMonth; i++) {
        const dayCell = document.createElement('div');
        dayCell.classList.add('calendar-cell');
        
        // Número do dia
        const dayNumber = document.createElement('div');
        dayNumber.textContent = i;
        dayCell.appendChild(dayNumber);
        
        // Verificar se é o dia atual
        if (currentViewDate.getMonth() === today.getMonth() && 
            currentViewDate.getFullYear() === today.getFullYear() && 
            i === today.getDate()) {
            dayCell.classList.add('current');
        }
        
        // Verificar se há eventos neste dia (CORREÇÃO DO FUSO HORÁRIO)
        const dayEvents = events.filter(event => {
            if (!event.date) return false;
            
            // CORREÇÃO: Usar data normalizada sem fuso horário
            const eventDate = new Date(event.date + 'T12:00:00');
            const compareDate = new Date(currentViewDate.getFullYear(), currentViewDate.getMonth(), i);
            
            return eventDate.getDate() === compareDate.getDate() && 
                   eventDate.getMonth() === compareDate.getMonth() && 
                   eventDate.getFullYear() === compareDate.getFullYear();
        });
        
        if (dayEvents.length > 0) {
            dayCell.classList.add('has-events');
            
            // Adicionar título do primeiro evento abaixo do dia
            const eventTitle = document.createElement('div');
            eventTitle.classList.add('event-title');
            eventTitle.textContent = dayEvents[0].title;
            dayCell.appendChild(eventTitle);
            
            // Se houver mais de um evento, adicionar indicador
            if (dayEvents.length > 1) {
                const moreEvents = document.createElement('div');
                moreEvents.classList.add('event-title');
                moreEvents.textContent = `+${dayEvents.length - 1} mais`;
                dayCell.appendChild(moreEvents);
            }
        }
        
        dayCell.addEventListener('click', () => {
            if (dayEvents.length > 0) {
                openViewEventsModal(dayEvents);
            } else {
                const selectedDate = new Date(currentViewDate.getFullYear(), currentViewDate.getMonth(), i);
                openAddEventModal(selectedDate);
            }
        });
        
        calendarDays.appendChild(dayCell);
      }
      
      // Calcular quantos dias do próximo mês precisamos adicionar
      const totalCells = 42; // 6 linhas x 7 dias
      const remainingCells = totalCells - (startDayOfWeek + daysInMonth);
      
      // Adicionar dias do próximo mês
      for (let i = 1; i <= remainingCells; i++) {
        const dayCell = document.createElement('div');
        dayCell.classList.add('calendar-cell');
        dayCell.textContent = i;
        dayCell.style.opacity = '0.4';
        calendarDays.appendChild(dayCell);
      }
    }
    
    // Renderizar tarefas
    function renderTasks() {
      const taskList = document.getElementById('task-list');
      
      if (tasks.length === 0) {
        taskList.innerHTML = `
              <div class="empty-state">
                <i class="fas fa-tasks" style="font-size: 2rem; margin-bottom: 10px;"></i>
                <p>Nenhuma tarefa adicionada</p>
              </div>
            `;
        return;
      }
      
      taskList.innerHTML = '';
      tasks.forEach((task, index) => {
        const taskItem = document.createElement('li');
        taskItem.innerHTML = `
              <input type="checkbox" id="task-${index}" ${task.completed ? 'checked' : ''}>
              <label for="task-${index}" class="${task.completed ? 'completed' : ''}">${task.text}</label>
              <span class="delete-btn" data-index="${index}"><i class="fas fa-trash"></i></span>
            `;
        
        // Evento para marcar/desmarcar tarefa
        const checkbox = taskItem.querySelector('input');
        checkbox.addEventListener('change', () => toggleTaskCompleted(index));
        
        // Evento para excluir tarefa
        const deleteBtn = taskItem.querySelector('.delete-btn');
        deleteBtn.addEventListener('click', () => deleteTask(index));
        
        taskList.appendChild(taskItem);
      });
    }
    
    // Renderizar metas (VERSÃO CORRIGIDA)
    function renderGoals() {
      const goalsList = document.getElementById('goals-list');
      
      if (goals.length === 0) {
        goalsList.innerHTML = `
              <div class="empty-state">
                <i class="fas fa-plus-circle" style="font-size: 2rem; margin-bottom: 10px;"></i>
                <p>Você ainda não tem metas</p>
                <button class="motivation-btn" onclick="openAddGoalModal()">Adicionar Meta</button>
              </div>
            `;
        return;
      }
      
      goalsList.innerHTML = '';
      goals.forEach((goal, index) => {
        const goalItem = document.createElement('div');
        goalItem.classList.add('goal-item');
        
        // CORREÇÃO: Adicionar informação de prazo se existir
        let deadlineInfo = '';
        if (goal.deadline) {
            const deadlineDate = new Date(goal.deadline + 'T12:00:00');
            deadlineInfo = `<br><small>Prazo: ${deadlineDate.toLocaleDateString('pt-BR')}</small>`;
        }
        
        goalItem.innerHTML = `
              <div style="display: flex; align-items: center; padding: 10px; border-bottom: 1px solid var(--lilás-claro);">
                <input type="checkbox" id="goal-${index}" ${goal.completed ? 'checked' : ''} style="margin-right: 10px;">
                <div style="flex: 1;">
                    <label for="goal-${index}" style="${goal.completed ? 'text-decoration: line-through; color: var(--lilás);' : ''}">
                        ${goal.text}
                    </label>
                    ${deadlineInfo}
                </div>
                <span class="delete-btn" data-index="${index}" style="margin-left: 10px; cursor: pointer;">
                    <i class="fas fa-trash"></i>
                </span>
              </div>
            `;
        
        // Evento para marcar/desmarcar meta como concluída
        const checkbox = goalItem.querySelector('input');
        checkbox.addEventListener('change', () => toggleGoalCompleted(index));
        
        // Evento para excluir meta
        const deleteBtn = goalItem.querySelector('.delete-btn');
        deleteBtn.addEventListener('click', () => deleteGoal(index));
        
        goalsList.appendChild(goalItem);
      });
      
      // Adicionar botão para adicionar mais metas
      const addButton = document.createElement('div');
      addButton.style.textAlign = 'center';
      addButton.style.marginTop = '15px';
      addButton.innerHTML = `<button class="motivation-btn" onclick="openAddGoalModal()">Adicionar Meta</button>`;
      goalsList.appendChild(addButton);
    }
    
    // Renderizar lembretes
    function renderReminders() {
      const remindersList = document.getElementById('reminders-list');
      
      if (reminders.length === 0) {
        remindersList.innerHTML = `
              <div class="empty-state">
                <i class="far fa-bell" style="font-size: 2rem; margin-bottom: 10px;"></i>
                <p>Nenhum lembrete adicionado</p>
                <button class="motivation-btn" onclick="openAddReminderModal()">Adicionar Lembrete</button>
              </div>
            `;
        return;
      }
      
      remindersList.innerHTML = '';
      reminders.forEach((reminder, index) => {
        const reminderItem = document.createElement('div');
        reminderItem.classList.add('reminder-item');
        
        let dateInfo = '';
        if (reminder.date) {
          const date = new Date(reminder.date + 'T12:00:00');
          dateInfo = `<br><small>${date.toLocaleDateString('pt-BR')}</small>`;
        }
        
        reminderItem.innerHTML = `
              <div style="padding: 10px; border-bottom: 1px solid var(--lilás-claro);">
                <i class="far fa-bell" style="margin-right: 10px;"></i> 
                ${reminder.text}${dateInfo}
                <span class="delete-btn" data-index="${index}" style="float: right;"><i class="fas fa-trash"></i></span>
              </div>
            `;
        
        // Evento para excluir lembrete
        const deleteBtn = reminderItem.querySelector('.delete-btn');
        deleteBtn.addEventListener('click', () => deleteReminder(index));
        
        remindersList.appendChild(reminderItem);
      });
      
      // Adicionar botão para adicionar mais lembretes
      const addButton = document.createElement('div');
      addButton.style.textAlign = 'center';
      addButton.style.marginTop = '15px';
      addButton.innerHTML = `<button class="motivation-btn" onclick="openAddReminderModal()">Adicionar Lembrete</button>`;
      remindersList.appendChild(addButton);
    }
    
    // Adicionar tarefa a partir do input
    function addTaskFromInput() {
      const taskInput = document.getElementById('new-task-input');
      const text = taskInput.value.trim();
      
      if (text) {
        tasks.push({
          text: text,
          completed: false,
          createdAt: new Date()
        });
        
        taskInput.value = '';
        saveToLocalStorage();
        renderTasks();
      }
    }
    
    // Alternar estado de conclusão da tarefa
    function toggleTaskCompleted(index) {
      tasks[index].completed = !tasks[index].completed;
      saveToLocalStorage();
      renderTasks();
    }
    
    // Alternar estado de conclusão da meta (NOVA FUNÇÃO)
    function toggleGoalCompleted(index) {
      goals[index].completed = !goals[index].completed;
      saveToLocalStorage();
      renderGoals();
    }
    
    // Excluir tarefa
    function deleteTask(index) {
      tasks.splice(index, 1);
      saveToLocalStorage();
      renderTasks();
    }
    
    // Excluir meta
    function deleteGoal(index) {
      goals.splice(index, 1);
      saveToLocalStorage();
      renderGoals();
    }
    
    // Excluir lembrete
    function deleteReminder(index) {
      reminders.splice(index, 1);
      saveToLocalStorage();
      renderReminders();
    }
    
    // Abrir modal de adicionar evento
    function openAddEventModal(date) {
      document.getElementById('event-date').valueAsDate = date;
      document.getElementById('event-modal').style.display = 'flex';
    }
    
    // Abrir modal de visualizar eventos
    function openViewEventsModal(dayEvents) {
      const eventDetails = document.getElementById('event-details');
      eventDetails.innerHTML = '';
      
      if (dayEvents.length === 0) {
        eventDetails.innerHTML = '<p>Nenhum evento para este dia.</p>';
      } else {
        dayEvents.forEach(event => {
          const eventDate = new Date((event.timestamp || event.date) + 'T12:00:00');
          const eventElement = document.createElement('div');
          eventElement.style.marginBottom = '15px';
          eventElement.style.padding = '10px';
          eventElement.style.border = '1px solid var(--lilás)';
          eventElement.style.borderRadius = '5px';
          eventElement.innerHTML = `
                <h4>${event.title}</h4>
                <p><strong>Data:</strong> ${eventDate.toLocaleDateString('pt-BR')}</p>
                ${event.description ? `<p>${event.description}</p>` : ''}
            `;
          eventDetails.appendChild(eventElement);
        });
      }
      
      // Configurar botão de excluir para o primeiro evento
      if (dayEvents.length > 0) {
        selectedEventId = dayEvents[0].id;
      }
      
      document.getElementById('view-event-modal').style.display = 'flex';
    }
    
    // Fechar modal
    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }
    
    // Adicionar evento (VERSÃO CORRIGIDA - Fuso horário fixo)
    function addEvent() {
      const title = document.getElementById('event-title').value.trim();
      const dateInput = document.getElementById('event-date').value;
      const description = document.getElementById('event-description').value.trim();
      
      if (title && dateInput) {
        // CORREÇÃO: Criar data sem problemas de fuso horário
        const eventDate = new Date(dateInput + 'T12:00:00');
        
        const event = {
          id: Date.now(),
          title: title,
          date: dateInput,
          description: description,
          timestamp: eventDate.getTime()
        };
        
        events.push(event);
        saveToLocalStorage();
        renderCalendar();
        closeModal('event-modal');
        
        // Limpar formulário
        document.getElementById('event-title').value = '';
        document.getElementById('event-description').value = '';
      } else {
        alert('Por favor, preencha pelo menos o título e a data do evento.');
      }
    }
    
    // Excluir evento
    function deleteEvent() {
      if (selectedEventId) {
        events = events.filter(event => event.id !== selectedEventId);
        saveToLocalStorage();
        renderCalendar();
        closeModal('view-event-modal');
        selectedEventId = null;
      }
    }
    
    // Abrir modal de adicionar meta
    function openAddGoalModal() {
      document.getElementById('goal-modal').style.display = 'flex';
    }
    
    // Adicionar meta (VERSÃO CORRIGIDA)
    function addGoal() {
      const title = document.getElementById('goal-title').value.trim();
      const deadline = document.getElementById('goal-deadline').value;
      
      if (title) {
        // CORREÇÃO: Garantir que o ID seja único
        goals.push({
          id: Date.now() + Math.random(),
          text: title,
          deadline: deadline,
          completed: false,
          createdAt: new Date().toISOString()
        });
        
        saveToLocalStorage();
        renderGoals();
        closeModal('goal-modal');
        
        // Limpar formulário
        document.getElementById('goal-title').value = '';
        document.getElementById('goal-deadline').value = '';
      } else {
        alert('Por favor, preencha o título da meta.');
      }
    }
    
    // Abrir modal de adicionar lembrete
    function openAddReminderModal() {
      document.getElementById('reminder-modal').style.display = 'flex';
    }
    
    // Adicionar lembrete
    function addReminder() {
      const title = document.getElementById('reminder-title').value.trim();
      const date = document.getElementById('reminder-date').value;
      
      if (title) {
        reminders.push({
          id: Date.now(),
          text: title,
          date: date
        });
        
        saveToLocalStorage();
        renderReminders();
        closeModal('reminder-modal');
        
        // Limpar formulário
        document.getElementById('reminder-title').value = '';
        document.getElementById('reminder-date').value = '';
      } else {
        alert('Por favor, preencha o lembrete.');
      }
    }
    
    // Gerar nova motivação
    function newMotivation() {
      const motivationText = document.getElementById('motivation-text');
      const randomIndex = Math.floor(Math.random() * motivations.length);
      motivationText.textContent = `"${motivations[randomIndex]}"`;
    }
    
    // Salvar no localStorage
    function saveToLocalStorage() {
      localStorage.setItem('kuromi-tasks', JSON.stringify(tasks));
      localStorage.setItem('kuromi-events', JSON.stringify(events));
      localStorage.setItem('kuromi-goals', JSON.stringify(goals));
      localStorage.setItem('kuromi-reminders', JSON.stringify(reminders));
    }
    
    // Carregar do localStorage (VERSÃO CORRIGIDA)
    function loadFromLocalStorage() {
      const savedTasks = localStorage.getItem('kuromi-tasks');
      const savedEvents = localStorage.getItem('kuromi-events');
      const savedGoals = localStorage.getItem('kuromi-goals');
      const savedReminders = localStorage.getItem('kuromi-reminders');
      
      if (savedTasks) tasks = JSON.parse(savedTasks);
      if (savedEvents) {
        events = JSON.parse(savedEvents);
        // CORREÇÃO: Normalizar datas existentes
        events.forEach(event => {
          if (event.date && !event.timestamp) {
            event.timestamp = new Date(event.date + 'T12:00:00').getTime();
          }
        });
      }
      if (savedGoals) goals = JSON.parse(savedGoals);
      if (savedReminders) reminders = JSON.parse(savedReminders);
      
      // CORREÇÃO: Garantir que goals seja um array se estiver vazio
      if (!goals) goals = [];
    }
    
    // Configurar navegação
    function setupNavigation() {
      const navLinks = document.querySelectorAll('.nav-tabs a');
      
      navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          
          // Remover a classe active de todos os links
          navLinks.forEach(l => l.classList.remove('active'));
          
          // Adicionar a classe active ao link clicado
          this.classList.add('active');
          
          // Verificar qual link foi clicado
          if (this.innerHTML.includes('Tarefas')) {
            document.querySelector('.todo-list').scrollIntoView({ 
              behavior: 'smooth' 
            });
          } else if (this.innerHTML.includes('Calendário')) {
            document.querySelector('.calendar').scrollIntoView({ 
              behavior: 'smooth' 
            });
          } else if (this.innerHTML.includes('Metas')) {
            document.querySelector('#goals-list').scrollIntoView({ 
              behavior: 'smooth' 
            });
          } else {
            window.scrollTo({ top: 0, behavior: 'smooth' });
          }
        });
      });
    }
  </script>
</body>
</html>