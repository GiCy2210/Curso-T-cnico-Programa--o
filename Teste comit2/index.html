<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saúde Mental - Teste de Depressão PHQ-9</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #5b7fb5;
            --secondary-color: #6b8cbc;
            --accent-color: #ff6b6b;
            --light-color: #f0f5ff;
            --dark-color: #2c3e50;
            --success-color: #5cb85c;
            --warning-color: #f0ad4e;
            --info-color: #5bc0de;
            --gradient-start: #6a89cc;
            --gradient-end: #4a69bd;
            --card-shadow: 0 10px 20px rgba(91, 127, 181, 0.2);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--light-color) 0%, #e6eeff 100%);
            color: var(--dark-color);
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: 40px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px 20px;
            background: linear-gradient(120deg, var(--gradient-start), var(--gradient-end));
            color: white;
            border-radius: 15px;
            box-shadow: var(--card-shadow);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(45deg);
            z-index: 1;
        }
        
        .header-content {
            position: relative;
            z-index: 2;
        }
        
        h1 {
            margin-bottom: 10px;
            font-size: 2.5rem;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        .header-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            border-left: 5px solid var(--primary-color);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(91, 127, 181, 0.3);
        }
        
        .card-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            color: var(--primary-color);
            border-bottom: 2px solid #f0f5ff;
            padding-bottom: 10px;
        }
        
        .card-title i {
            font-size: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        input[type="text"],
        input[type="email"],
        input[type="password"] {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e8ff;
            border-radius: 8px;
            font-size: 16px;
            transition: var(--transition);
        }
        
        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="password"]:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(91, 127, 181, 0.2);
            outline: none;
        }
        
        button {
            background: linear-gradient(to right, var(--gradient-start), var(--gradient-end));
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 10px rgba(91, 127, 181, 0.3);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(91, 127, 181, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(to right, #a5b1c2, #778ca3);
        }
        
        .btn-alert {
            background: linear-gradient(to right, #ff7f50, #ff6b6b);
        }
        
        .question {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px dashed #e1e8ff;
        }
        
        .question-text {
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 1.1rem;
            color: var(--dark-color);
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        
        .question-number {
            background: var(--primary-color);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }
        
        .options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }
        
        @media (max-width: 768px) {
            .options {
                grid-template-columns: 1fr;
            }
        }
        
        .option {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 2px solid #e1e8ff;
            border-radius: 8px;
            transition: var(--transition);
            cursor: pointer;
        }
        
        .option:hover {
            border-color: var(--primary-color);
            background-color: #f8faff;
        }
        
        .option input {
            margin-right: 10px;
            cursor: pointer;
        }
        
        .results {
            text-align: center;
        }
        
        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: 0 auto 25px;
            box-shadow: 0 8px 15px rgba(91, 127, 181, 0.3);
        }
        
        .score-value {
            font-size: 3rem;
            font-weight: 700;
            line-height: 1;
        }
        
        .score-label {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .interpretation {
            background-color: #f8faff;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border-left: 4px solid var(--primary-color);
        }
        
        .interpretation h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .hidden {
            display: none;
        }
        
        .tab-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
        }
        
        .tab {
            display: flex;
            background: linear-gradient(to right, var(--gradient-start), var(--gradient-end));
            overflow-x: auto;
        }
        
        .tab button {
            background: transparent;
            box-shadow: none;
            border-radius: 0;
            padding: 18px 25px;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
        }
        
        .tab button:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: none;
        }
        
        .tab button.active {
            border-bottom: 3px solid white;
            background: rgba(255, 255, 255, 0.15);
        }
        
        .tabcontent {
            display: none;
            padding: 30px;
            animation: fadeEffect 0.5s;
        }
        
        @keyframes fadeEffect {
            from {opacity: 0; transform: translateY(10px);}
            to {opacity: 1; transform: translateY(0);}
        }
        
        .history-item {
            padding: 20px;
            border-bottom: 1px solid #e1e8ff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }
        
        .history-item:hover {
            background-color: #f8faff;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .history-date {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .history-score {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--dark-color);
        }
        
        .history-severity {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .severity-min {
            background: #e6f7ee;
            color: #0cab5b;
        }
        
        .severity-mild {
            background: #fff4e6;
            color: #f9a825;
        }
        
        .severity-moderate {
            background: #ffece6;
            color: #ff6b35;
        }
        
        .severity-severe {
            background: #ffe6e6;
            color: #ff4757;
        }
        
        .alert {
            padding: 15px 20px;
            background-color: #ffe6e6;
            color: #ff4757;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-left: 4px solid #ff4757;
        }
        
        .alert-success {
            background-color: #e6f7ee;
            color: #0cab5b;
            border-left: 4px solid #0cab5b;
        }
        
        .disclaimer {
            font-size: 14px;
            color: #666;
            margin-top: 40px;
            padding: 20px;
            background-color: #f8faff;
            border-radius: 12px;
            text-align: center;
            border: 1px dashed #c5d0ff;
        }
        
        .user-welcome {
            text-align: center;
            margin: 10px 0 30px;
            font-size: 1.1rem;
        }
        
        .welcome-name {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .progress-container {
            height: 8px;
            background-color: #e1e8ff;
            border-radius: 4px;
            margin: 30px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, var(--gradient-start), var(--gradient-end));
            border-radius: 4px;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .progress-text {
            text-align: center;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            color: #777;
            font-size: 0.9rem;
        }
        
        .feature-icon {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 20px;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 30px 0;
        }
        
        .feature {
            text-align: center;
            padding: 25px 15px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
        }
        
        .feature:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .feature h3 {
            margin: 15px 0 10px;
            color: var(--primary-color);
        }
        
        @media (max-width: 768px) {
            .features {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .header-subtitle {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1><i class="fas fa-heartbeat"></i> Saúde Mental</h1>
                <p class="header-subtitle">Questionário PHQ-9 para avaliação de sintomas depressivos</p>
            </div>
        </header>

        <div class="user-welcome" id="userWelcome">
            <p>Olá, <span class="welcome-name" id="welcomeName">visitante</span>! Faça login para acessar seu teste.</p>
        </div>

        <div class="features">
            <div class="feature">
                <div class="feature-icon">
                    <i class="fas fa-lock"></i>
                </div>
                <h3>Privacidade</h3>
                <p>Seus dados são armazenados localmente com total privacidade</p>
            </div>
            <div class="feature">
                <div class="feature-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h3>geovane gay baitola, viado</h3>
                <p>Visualize seu histórico de resultados e evolua sua saúde mental</p>
            </div>
            <div class="feature">
                <div class="feature-icon">
                    <i class="fas fa-heart"></i>
                </div>
                <h3>Cuide de Você</h3>
                <p>Autoconhecimento é o primeiro passo para o bem-estar</p>
            </div>
        </div>

        <div class="tab-container">
            <div class="tab">
                <button class="tablinks active" onclick="openTab(event, 'LoginTab')"><i class="fas fa-sign-in-alt"></i> Login</button>
                <button class="tablinks" onclick="openTab(event, 'RegisterTab')"><i class="fas fa-user-plus"></i> Criar Conta</button>
                <button class="tablinks" onclick="openTab(event, 'TestTab')"><i class="fas fa-clipboard-list"></i> Fazer Teste</button>
                <button class="tablinks" onclick="openTab(event, 'HistoryTab')"><i class="fas fa-history"></i> Histórico</button>
            </div>

            <!-- Login Tab -->
            <div id="LoginTab" class="tabcontent" style="display: block;">
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-sign-in-alt"></i> Acesse Sua Conta</h2>
                    <div class="form-group">
                        <label for="loginEmail">Email:</label>
                        <input type="email" id="loginEmail" placeholder="Seu endereço de email" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Senha:</label>
                        <input type="password" id="loginPassword" placeholder="Sua senha" required>
                    </div>
                    <button onclick="login()"><i class="fas fa-sign-in-alt"></i> Entrar</button>
                    <p id="loginMessage" class="alert hidden"></p>
                </div>
            </div>

            <!-- Register Tab -->
            <div id="RegisterTab" class="tabcontent">
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-user-plus"></i> Criar Nova Conta</h2>
                    <div class="form-group">
                        <label for="registerName">Nome Completo:</label>
                        <input type="text" id="registerName" placeholder="Seu nome completo" required>
                    </div>
                    <div class="form-group">
                        <label for="registerEmail">Email:</label>
                        <input type="email" id="registerEmail" placeholder="Seu melhor email" required>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Senha:</label>
                        <input type="password" id="registerPassword" placeholder="Crie uma senha segura" required>
                    </div>
                    <div class="form-group">
                        <label for="registerAge">Idade:</label>
                        <input type="text" id="registerAge" placeholder="Sua idade" required>
                    </div>
                    <div class="form-group">
                        <label for="registerGender">Gênero:</label>
                        <input type="text" id="registerGender" placeholder="Seu gênero" required>
                    </div>
                    <button onclick="register()"><i class="fas fa-user-plus"></i> Criar Conta</button>
                    <p id="registerMessage" class="alert hidden"></p>
                </div>
            </div>

            <!-- Test Tab -->
            <div id="TestTab" class="tabcontent">
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-clipboard-list"></i> Questionário PHQ-9</h2>
                    <p>Nas últimas 2 semanas, com que frequência você foi incomodado pelos seguintes problemas?</p>
                    
                    <div class="progress-container">
                        <div class="progress-bar" id="testProgress"></div>
                    </div>
                    <p class="progress-text" id="progressText">0% completo</p>
                    
                    <form id="phq9Form">
                        <div class="question">
                            <div class="question-text">1. Pouco interesse ou prazer em fazer coisas</div>
                            <div class="options">
                                <label class="option"><input type="radio" name="q1" value="0" required> Nenhum dia</label>
                                <label class="option"><input type="radio" name="q1" value="1"> Vários dias</label>
                                <label class="option"><input type="radio" name="q1" value="2"> Mais da metade dos dias</label>
                                <label class="option"><input type="radio" name="q1" value="3"> Quase todos os dias</label>
                            </div>
                        </div>
                        
                        <div class="question">
                            <div class="question-text">2. Sentindo-se para baixo, deprimido ou sem esperança</div>
                            <div class="options">
                                <label class="option"><input type="radio" name="q2" value="0" required> Nenhum dia</label>
                                <label class="option"><input type="radio" name="q2" value="1"> Vários dias</label>
                                <label class="option"><input type="radio" name="q2" value="2"> Mais da metade dos dias</label>
                                <label class="option"><input type="radio" name="q2" value="3"> Quase todos os dias</label>
                            </div>
                        </div>
                        
                        <div class="question">
                            <div class="question-text">3. Dificuldade em pegar no sono ou manter o sono, ou dormir demais</div>
                            <div class="options">
                                <label class="option"><input type="radio" name="q3" value="0" required> Nenhum dia</label>
                                <label class="option"><input type="radio" name="q3" value="1"> Vários dias</label>
                                <label class="option"><input type="radio" name="q3" value="2"> Mais da metade dos dias</label>
                                <label class="option"><input type="radio" name="q3" value="3"> Quase todos os dias</label>
                            </div>
                        </div>
                        
                        <div class="question">
                            <div class="question-text">4. Sentindo-se cansado ou com pouca energia</div>
                            <div class="options">
                                <label class="option"><input type="radio" name="q4" value="0" required> Nenhum dia</label>
                                <label class="option"><input type="radio" name="q4" value="1"> Vários dias</label>
                                <label class="option"><input type="radio" name="q4" value="2"> Mais da metade dos dias</label>
                                <label class="option"><input type="radio" name="q4" value="3"> Quase todos os dias</label>
                            </div>
                        </div>
                        
                        <div class="question">
                            <div class="question-text">5. Falta de apetite ou comendo demais</div>
                            <div class="options">
                                <label class="option"><input type="radio" name="q5" value="0" required> Nenhum dia</label>
                                <label class="option"><input type="radio" name="q5" value="1"> Vários dias</label>
                                <label class="option"><input type="radio" name="q5" value="2"> Mais da metade dos dias</label>
                                <label class="option"><input type="radio" name="q5" value="3"> Quase todos os dias</label>
                            </div>
                        </div>
                        
                        <div class="question">
                            <div class="question-text">6. Sentindo-se mal consigo mesmo - ou que você é um fracasso ou que decepcionou a si mesmo ou sua família</div>
                            <div class="options">
                                <label class="option"><input type="radio" name="q6" value="0" required> Nenhum dia</label>
                                <label class="option"><input type="radio" name="q6" value="1"> Vários dias</label>
                                <label class="option"><input type="radio" name="q6" value="2"> Mais da metade dos dias</label>
                                <label class="option"><input type="radio" name="q6" value="3"> Quase todos os dias</label>
                            </div>
                        </div>
                        
                        <div class="question">
                            <div class="question-text">7. Dificuldade de concentração em coisas, como ler o jornal ou assistir televisão</div>
                            <div class="options">
                                <label class="option"><input type="radio" name="q7" value="0" required> Nenhum dia</label>
                                <label class="option"><input type="radio" name="q7" value="1"> Vários dias</label>
                                <label class="option"><input type="radio" name="q7" value="2"> Mais da metade dos dias</label>
                                <label class="option"><input type="radio" name="q7" value="3"> Quase todos os dias</label>
                            </div>
                        </div>
                        
                        <div class="question">
                            <div class="question-text">8. Movendo-se ou falando tão devagar que os outros poderiam ter notado. Ou o contrário - tão agitado que você tem se movido muito mais do que o habitual</div>
                            <div class="options">
                                <label class="option"><input type="radio" name="q8" value="0" required> Nenhum dia</label>
                                <label class="option"><input type="radio" name="q8" value="1"> Vários dias</label>
                                <label class="option"><input type="radio" name="q8" value="2"> Mais da metade dos dias</label>
                                <label class="option"><input type="radio" name="q8" value="3"> Quase todos os dias</label>
                            </div>
                        </div>
                        
                        <div class="question">
                            <div class="question-text">9. Pensamentos de que você estaria melhor morto ou de machucar a si mesmo de alguma forma</div>
                            <div class="options">
                                <label class="option"><input type="radio" name="q9" value="0" required> Nenhum dia</label>
                                <label class="option"><input type="radio" name="q9" value="1"> Vários dias</label>
                                <label class="option"><input type="radio" name="q9" value="2"> Mais da metade dos dias</label>
                                <label class="option"><input type="radio" name="q9" value="3"> Quase todos os dias</label>
                            </div>
                        </div>
                        
                        <!-- As outras questões seguem o mesmo padrão -->
                        <!-- Para brevidade, mantive apenas 2 questões no exemplo -->
                        
                        <button type="submit"><i class="fas fa-check-circle"></i> Finalizar Teste</button>
                    </form>
                </div>
            </div>

            <!-- Results Tab -->
            <div id="ResultsTab" class="tabcontent">
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-chart-pie"></i> Resultado do Teste</h2>
                    
                    <div class="score-circle">
                        <div class="score-value" id="scoreValue">0</div>
                        <div class="score-label">Pontuação</div>
                    </div>
                    
                    <div class="interpretation">
                        <h3><i class="fas fa-info-circle"></i> Interpretação:</h3>
                        <p id="interpretationText"></p>
                    </div>
                    
                    <div class="alert" id="alertWarning" style="display: none;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div>
                            <strong>Alerta importante:</strong> Suas respostas indicam pensamentos sobre morte ou autolesão. 
                            É muito importante buscar ajuda profissional imediatamente.
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px;">
                        <button onclick="openTab(event, 'TestTab')"><i class="fas fa-redo"></i> Fazer Novo Teste</button>
                        <button class="btn-secondary" onclick="openTab(event, 'HistoryTab')"><i class="fas fa-history"></i> Ver Histórico</button>
                    </div>
                </div>
            </div>

            <!-- History Tab -->
            <div id="HistoryTab" class="tabcontent">
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-history"></i> Histórico de Testes</h2>
                    <div id="testsHistory"></div>
                </div>
            </div>
        </div>

        <div class="disclaimer">
            <p><strong>Nota importante:</strong> Este teste é baseado no PHQ-9, um instrumento válido para rastreamento de depressão, mas não substitui um diagnóstico profissional. Se você está passando por dificuldades, procure ajuda de um profissional de saúde mental.</p>
        </div>

        <div class="footer">
            <p>Saúde Mental &copy; 2023 - Todos os direitos reservados</p>
        </div>
    </div>

    <script>
        // Variáveis globais
        let currentUser = null;
        let users = JSON.parse(localStorage.getItem('phq9_users')) || [];
        let tests = JSON.parse(localStorage.getItem('phq9_tests')) || [];

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar se há usuário logado
            const savedUser = localStorage.getItem('phq9_currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                updateUI();
            }
            
            // Configurar submissão do formulário
            document.getElementById('phq9Form').addEventListener('submit', function(e) {
                e.preventDefault();
                calculateScore();
            });
            
            // Configurar eventos para atualizar a barra de progresso
            const radioInputs = document.querySelectorAll('input[type="radio"]');
            radioInputs.forEach(input => {
                input.addEventListener('change', updateProgress);
            });
        });

        // Atualizar barra de progresso
        function updateProgress() {
            if (!currentUser) return;
            
            const totalQuestions = 9; // Número total de questões
            let answered = 0;
            
            for (let i = 1; i <= totalQuestions; i++) {
                if (document.querySelector(`input[name="q${i}"]:checked`)) {
                    answered++;
                }
            }
            
            const progress = (answered / totalQuestions) * 100;
            document.getElementById('testProgress').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `${Math.round(progress)}% completo`;
        }

        // Funções de abas
        function openTab(evt, tabName) {
            // Esconder todos os tabcontent
            const tabcontent = document.getElementsByClassName('tabcontent');
            for (let i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = 'none';
            }
            
            // Remover a classe active de todos os tablinks
            const tablinks = document.getElementsByClassName('tablinks');
            for (let i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(' active', '');
            }
            
            // Mostrar a aba específica e adicionar a classe active ao botão que abriu a aba
            document.getElementById(tabName).style.display = 'block';
            if (evt && evt.currentTarget) {
                evt.currentTarget.className += ' active';
            } else {
                // Se a função foi chamada sem evento (como no login), ativar a primeira aba
                tablinks[0].className += ' active';
            }
            
            // Atualizar a interface se for a aba de histórico
            if (tabName === 'HistoryTab') {
                loadHistory();
            }
            
            // Se for a aba de teste, atualizar o progresso
            if (tabName === 'TestTab') {
                updateProgress();
            }
        }

        // Funções de usuário
        function register() {
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const age = document.getElementById('registerAge').value;
            const gender = document.getElementById('registerGender').value;
            
            // Validação simples
            if (!name || !email || !password || !age || !gender) {
                showMessage('registerMessage', 'Por favor, preencha todos os campos.');
                return;
            }
            
            // Verificar se o usuário já existe
            if (users.find(user => user.email === email)) {
                showMessage('registerMessage', 'Este email já está registrado.');
                return;
            }
            
            // Criar novo usuário
            const newUser = {
                id: Date.now().toString(),
                name,
                email,
                password,
                age,
                gender,
                createdAt: new Date().toISOString()
            };
            
            users.push(newUser);
            localStorage.setItem('phq9_users', JSON.stringify(users));
            
            showMessage('registerMessage', 'Conta criada com sucesso!', 'success');
            
            // Limpar formulário
            document.getElementById('registerName').value = '';
            document.getElementById('registerEmail').value = '';
            document.getElementById('registerPassword').value = '';
            document.getElementById('registerAge').value = '';
            document.getElementById('registerGender').value = '';
        }

        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Encontrar usuário
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('phq9_currentUser', JSON.stringify(user));
                updateUI();
                showMessage('loginMessage', 'Login realizado com sucesso!', 'success');
                openTab(null, 'TestTab');
            } else {
                showMessage('loginMessage', 'Email ou senha incorretos.');
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('phq9_currentUser');
            updateUI();
            openTab(null, 'LoginTab');
        }

        function updateUI() {
            if (currentUser) {
                document.getElementById('welcomeName').textContent = currentUser.name;
                document.querySelector('.tab').style.display = 'flex';
                
                // Atualizar botões de login/logout
                const loginTab = document.querySelector('.tablinks');
                loginTab.innerHTML = '<i class="fas fa-sign-out-alt"></i> Sair';
                loginTab.onclick = logout;
            } else {
                document.getElementById('welcomeName').textContent = 'visitante';
                document.querySelector('.tab').style.display = 'flex';
                
                // Restaurar botão de login
                const loginTab = document.querySelector('.tablinks');
                loginTab.innerHTML = '<i class="fas fa-sign-in-alt"></i> Login';
                loginTab.onclick = function(evt) { openTab(evt, 'LoginTab'); };
            }
        }

        // Funções do teste
        function calculateScore() {
            if (!currentUser) {
                alert('Por favor, faça login para realizar o teste.');
                openTab(null, 'LoginTab');
                return;
            }
            
            let totalScore = 0;
            
            // Calcular pontuação para cada pergunta
            for (let i = 1; i <= 9; i++) {
                const selectedOption = document.querySelector(`input[name="q${i}"]:checked`);
                if (selectedOption) {
                    totalScore += parseInt(selectedOption.value);
                }
            }
            
            // Salvar o teste
            const testResult = {
                id: Date.now().toString(),
                userId: currentUser.id,
                score: totalScore,
                date: new Date().toISOString()
            };
            
            tests.push(testResult);
            localStorage.setItem('phq9_tests', JSON.stringify(tests));
            
            // Mostrar resultados
            showResults(totalScore);
        }

        function showResults(score) {
            document.getElementById('scoreValue').textContent = score;
            
            let interpretation = '';
            if (score >= 0 && score <= 4) {
                interpretation = 'Nenhum ou mínimo de depressão. Seus sintomas depressivos são mínimos ou ausentes.';
            } else if (score >= 5 && score <= 9) {
                interpretation = 'Depressão leve. Você pode estar experimentando alguns sintomas depressivos. É importante monitorar seu humor.';
            } else if (score >= 10 && score <= 14) {
                interpretation = 'Depressão moderada. Seus sintomas sugerem depressão moderada. Considere buscar apoio profissional.';
            } else if (score >= 15 && score <= 19) {
                interpretation = 'Depressão moderadamente grave. Seus sintomas depressivos são significativos. Recomenda-se procurar ajuda profissional.';
            } else {
                interpretation = 'Depressão grave. Seus sintomas são severos. É altamente recomendável buscar ajuda de um profissional de saúde mental.';
            }
            
            document.getElementById('interpretationText').textContent = interpretation;
            
            // Se houver pontuação na pergunta 9, mostrar alerta especial
            const q9Score = parseInt(document.querySelector('input[name="q9"]:checked').value);
            if (q9Score > 0) {
                document.getElementById('alertWarning').style.display = 'flex';
            } else {
                document.getElementById('alertWarning').style.display = 'none';
            }
            
            // Mostrar aba de resultados
            openTab(null, 'ResultsTab');
        }

        function loadHistory() {
            if (!currentUser) {
                document.getElementById('testsHistory').innerHTML = '<p>Por favor, faça login para ver seu histórico.</p>';
                return;
            }
            
            const userTests = tests.filter(test => test.userId === currentUser.id);
            
            if (userTests.length === 0) {
                document.getElementById('testsHistory').innerHTML = '<p>Nenhum teste realizado ainda.</p>';
                return;
            }
            
            let historyHTML = '';
            userTests.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(test => {
                const date = new Date(test.date).toLocaleDateString('pt-BR');
                
                let severity = '';
                let severityClass = '';
                if (test.score <= 4) {
                    severity = 'Mínima';
                    severityClass = 'severity-min';
                } else if (test.score <= 9) {
                    severity = 'Leve';
                    severityClass = 'severity-mild';
                } else if (test.score <= 14) {
                    severity = 'Moderada';
                    severityClass = 'severity-moderate';
                } else if (test.score <= 19) {
                    severity = 'Moderadamente Grave';
                    severityClass = 'severity-moderate';
                } else {
                    severity = 'Grave';
                    severityClass = 'severity-severe';
                }
                
                historyHTML += `
                    <div class="history-item">
                        <div class="history-date">${date}</div>
                        <div class="history-score">${test.score}</div>
                        <div class="history-severity ${severityClass}">${severity}</div>
                    </div>
                `;
            });
            
            document.getElementById('testsHistory').innerHTML = historyHTML;
        }

        // Utilitários
        function showMessage(elementId, message, type = 'error') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.classList.remove('hidden');
            
            if (type === 'success') {
                element.className = 'alert alert-success';
            } else {
                element.className = 'alert';
            }
            
            // Esconder a mensagem após 5 segundos
            setTimeout(() => {
                element.classList.add('hidden');
            }, 5000);
        }
    </script>
</body>
</html>